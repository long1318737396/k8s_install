---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    reloader.stakater.com/auto: 'true'
  labels:
    k8s.kuboard.cn/layer: web
    app: portal-frontend
  name: portal-frontend
  namespace: eworldcloud
spec:
  selector:
    matchLabels:
      app: portal-frontend
  template:
    metadata:
      labels:
        app: portal-frontend
    spec:
      containers:
      - image: harbor.mtywcloud.com/publish/portal-frontend:v1.0.20.1.72
        imagePullPolicy: IfNotPresent
        name: portal-frontend
        ports:
          - containerPort: 9000
            name: http
            protocol: TCP
        resources: 
          limits:
            cpu: 400m
            memory: 800Mi
          requests:
            cpu: 100m
            memory: 128Mi
        volumeMounts:
          - mountPath: /etc/nginx/nginx.conf
            name: nginxconf
            subPath: nginx.conf
          - mountPath: /etc/nginx/conf.d/
            name: frontendportalconf
            readOnly: true
          - mountPath: /var/www/config/Local/
            name: frontendjs-local
            readOnly: true
          - mountPath: /var/www/config/Internet/
            name: frontendjs-internet
            readOnly: true
      imagePullSecrets:
        - name: dev-harbor-secret
      serviceAccount: eworld-eworldcloud
      volumes:
        - configMap:
            defaultMode: 420
            name: nginxconf
          name: nginxconf
        - configMap:
            defaultMode: 420
            name: frontendportalconf
          name: frontendportalconf
        - configMap:
            defaultMode: 420
            name: frontendjs-local
          name: frontendjs-local
        - configMap:
            defaultMode: 420
            name: frontendjs-internet
          name: frontendjs-internet

---
apiVersion: v1
kind: Service
metadata:
  name: portal-frontend
  namespace: eworldcloud
spec:
  ports:
  - port: 9000
    protocol: TCP
    targetPort: 9000
  selector:
    app: portal-frontend
  sessionAffinity: None
  type: ClusterIP